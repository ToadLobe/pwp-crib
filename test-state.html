<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State.js Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        h1 {
            color: #60a5fa;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #3a3a3a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section h2 {
            margin-top: 0;
            color: #93c5fd;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            color: #4ade80;
        }
        .error {
            color: #f87171;
        }
        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>State Management Test</h1>

    <div class="test-section">
        <h2>1. Initialize State</h2>
        <button onclick="testLoadState()">Load State</button>
        <button onclick="testClearStorage()">Clear localStorage</button>
        <div id="init-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. Timer Functions</h2>
        <button onclick="testStartTimer()">Start Timer</button>
        <button onclick="testPauseTimer()">Pause Timer</button>
        <button onclick="testToggleTimer()">Toggle Timer</button>
        <button onclick="testResetTimer()">Reset Timer</button>
        <button onclick="testResetAll()">Reset All</button>
        <div id="timer-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. Input Management</h2>
        <button onclick="testAddEntry()">Add Patient Name</button>
        <button onclick="testAddScores()">Add PHQ9/GAD7 Scores</button>
        <button onclick="testRemoveEntry()">Remove Entry</button>
        <div id="input-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. Card Completion</h2>
        <button onclick="testToggleCard()">Toggle Card Completion</button>
        <button onclick="testSectionComplete()">Check Section Completion</button>
        <div id="card-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>5. Variables</h2>
        <button onclick="testGetVariable()">Test Variable Interpolation</button>
        <div id="variable-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Current State</h2>
        <button onclick="displayState()">Show State</button>
        <pre id="state-display"></pre>
    </div>

    <script src="state.js"></script>
    <script>
        // Test functions
        function testLoadState() {
            loadState();
            document.getElementById('init-result').innerHTML =
                '<span class="success">✓ State loaded successfully</span><br>' +
                'Session ID: ' + state.sessionId + '<br>' +
                'Elapsed Time: ' + state.elapsedTime + 'ms';
        }

        function testClearStorage() {
            localStorage.clear();
            document.getElementById('init-result').innerHTML =
                '<span class="success">✓ localStorage cleared</span>';
        }

        function testStartTimer() {
            startTimer();
            setTimeout(() => {
                document.getElementById('timer-result').innerHTML =
                    '<span class="success">✓ Timer started</span><br>' +
                    'isRunning: ' + state.isRunning + '<br>' +
                    'startTime: ' + new Date(state.startTime).toLocaleTimeString();
            }, 100);
        }

        function testPauseTimer() {
            pauseTimer();
            document.getElementById('timer-result').innerHTML =
                '<span class="success">✓ Timer paused</span><br>' +
                'isRunning: ' + state.isRunning + '<br>' +
                'elapsedTime: ' + state.elapsedTime + 'ms';
        }

        function testToggleTimer() {
            const wasRunning = state.isRunning;
            toggleTimer();
            document.getElementById('timer-result').innerHTML =
                '<span class="success">✓ Timer toggled</span><br>' +
                'Was running: ' + wasRunning + ' → Now running: ' + state.isRunning;
        }

        function testResetTimer() {
            resetTimer();
            document.getElementById('timer-result').innerHTML =
                '<span class="success">✓ Timer reset</span><br>' +
                'elapsedTime: ' + state.elapsedTime + 'ms';
        }

        function testResetAll() {
            resetAll();
            document.getElementById('timer-result').innerHTML =
                '<span class="success">✓ All state reset</span><br>' +
                'elapsedTime: ' + state.elapsedTime + 'ms<br>' +
                'patientName: "' + state.patientName + '"<br>' +
                'inputs: ' + JSON.stringify(state.inputs) + '<br>' +
                'completed: ' + JSON.stringify(state.completed);
        }

        function testAddEntry() {
            addEntry('patient-name', 'John Smith');
            document.getElementById('input-result').innerHTML =
                '<span class="success">✓ Entry added</span><br>' +
                'Patient Name: ' + state.patientName + '<br>' +
                'inputs["patient-name"]: ' + JSON.stringify(state.inputs['patient-name']);
        }

        function testAddScores() {
            addEntry('phq9-score', 12);
            addEntry('gad7-score', 15);
            document.getElementById('input-result').innerHTML =
                '<span class="success">✓ Scores added</span><br>' +
                'PHQ9: ' + state.inputs['phq9-score'][0] + '<br>' +
                'GAD7: ' + state.inputs['gad7-score'][0];
        }

        function testRemoveEntry() {
            if (state.inputs['patient-name'] && state.inputs['patient-name'].length > 0) {
                removeEntry('patient-name', 0);
                document.getElementById('input-result').innerHTML =
                    '<span class="success">✓ Entry removed</span><br>' +
                    'inputs["patient-name"]: ' + JSON.stringify(state.inputs['patient-name'] || []);
            } else {
                document.getElementById('input-result').innerHTML =
                    '<span class="error">✗ No entries to remove. Add one first.</span>';
            }
        }

        function testToggleCard() {
            toggleCardComplete('intro-card-1');
            toggleCardComplete('intro-card-2');
            document.getElementById('card-result').innerHTML =
                '<span class="success">✓ Card completion toggled</span><br>' +
                'intro-card-1: ' + (state.completed['intro-card-1'] ? 'Complete' : 'Incomplete') + '<br>' +
                'intro-card-2: ' + (state.completed['intro-card-2'] ? 'Complete' : 'Incomplete');
        }

        function testSectionComplete() {
            const sectionComplete = isSectionComplete('introduction');
            document.getElementById('card-result').innerHTML =
                '<span class="success">✓ Section completion checked</span><br>' +
                'Introduction section complete: ' + sectionComplete;
        }

        function testGetVariable() {
            const name = getVariable('name');
            const phqScore = getVariable('phqScore');
            const gadScore = getVariable('gadScore');
            document.getElementById('variable-result').innerHTML =
                '<span class="success">✓ Variables retrieved</span><br>' +
                '${name}: ' + name + '<br>' +
                '${phqScore}: ' + phqScore + '<br>' +
                '${gadScore}: ' + gadScore;
        }

        function displayState() {
            document.getElementById('state-display').textContent =
                JSON.stringify(state, null, 2);
        }

        // Auto-load state on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadState();
            console.log('Test page loaded. State initialized:', state);
        });
    </script>
</body>
</html>
